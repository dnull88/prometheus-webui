{"ast":null,"code":"import _objectSpread from\"/app/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/app/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/app/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/app/ui/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React,{useState,useEffect}from'react';import{Alert,Button}from'reactstrap';import Panel,{PanelDefaultOptions}from'./Panel';import Checkbox from'../../components/Checkbox';import{generateID,decodePanelOptionsFromQueryString,encodePanelOptionsToQueryString,callAll}from'../../utils';import{useFetch}from'../../hooks/useFetch';import{useLocalStorage}from'../../hooks/useLocalStorage';import{usePathPrefix}from'../../contexts/PathPrefixContext';import{API_PATH}from'../../constants/constants';export var updateURL=function updateURL(nextPanels){var query=encodePanelOptionsToQueryString(nextPanels);window.history.pushState({},'',query);};export var PanelListContent=function PanelListContent(_ref){var _ref$metrics=_ref.metrics,metrics=_ref$metrics===void 0?[]:_ref$metrics,useLocalTime=_ref.useLocalTime,queryHistoryEnabled=_ref.queryHistoryEnabled,enableAutocomplete=_ref.enableAutocomplete,rest=_objectWithoutProperties(_ref,[\"metrics\",\"useLocalTime\",\"queryHistoryEnabled\",\"enableAutocomplete\"]);var _useState=useState(rest.panels),_useState2=_slicedToArray(_useState,2),panels=_useState2[0],setPanels=_useState2[1];var _useLocalStorage=useLocalStorage('history',[]),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),historyItems=_useLocalStorage2[0],setLocalStorageHistoryItems=_useLocalStorage2[1];useEffect(function(){!panels.length&&addPanel();window.onpopstate=function(){var panels=decodePanelOptionsFromQueryString(window.location.search);if(panels.length>0){setPanels(panels);}};// We want useEffect to act only as componentDidMount, but react still complains about the empty dependencies list.\n// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var handleExecuteQuery=function handleExecuteQuery(query){var isSimpleMetric=metrics.indexOf(query)!==-1;if(isSimpleMetric||!query.length){return;}var extendedItems=historyItems.reduce(function(acc,metric){return metric===query?acc:[].concat(_toConsumableArray(acc),[metric]);// Prevent adding query twice.\n},[query]);setLocalStorageHistoryItems(extendedItems.slice(0,50));};var addPanel=function addPanel(){callAll(setPanels,updateURL)([].concat(_toConsumableArray(panels),[{id:generateID(),key:\"\".concat(panels.length),options:PanelDefaultOptions}]));};var pathPrefix=usePathPrefix();return/*#__PURE__*/React.createElement(React.Fragment,null,panels.map(function(_ref2){var id=_ref2.id,options=_ref2.options;return/*#__PURE__*/React.createElement(Panel,{pathPrefix:pathPrefix,onExecuteQuery:handleExecuteQuery,key:id,options:options,onOptionsChanged:function onOptionsChanged(opts){return callAll(setPanels,updateURL)(panels.map(function(p){return id===p.id?_objectSpread(_objectSpread({},p),{},{options:opts}):p;}));},removePanel:function removePanel(){return callAll(setPanels,updateURL)(panels.reduce(function(acc,panel){return panel.id!==id?[].concat(_toConsumableArray(acc),[_objectSpread(_objectSpread({},panel),{},{key:\"\".concat(acc.length)})]):acc;},[]));},useLocalTime:useLocalTime,metricNames:metrics,pastQueries:queryHistoryEnabled?historyItems:[],enableAutocomplete:enableAutocomplete});}),/*#__PURE__*/React.createElement(Button,{className:\"d-block mb-3\",color:\"primary\",onClick:addPanel},\"Add Panel\"));};var PanelList=function PanelList(){var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),delta=_useState4[0],setDelta=_useState4[1];var _useLocalStorage3=useLocalStorage('use-local-time',false),_useLocalStorage4=_slicedToArray(_useLocalStorage3,2),useLocalTime=_useLocalStorage4[0],setUseLocalTime=_useLocalStorage4[1];var _useLocalStorage5=useLocalStorage('enable-query-history',false),_useLocalStorage6=_slicedToArray(_useLocalStorage5,2),enableQueryHistory=_useLocalStorage6[0],setEnableQueryHistory=_useLocalStorage6[1];var _useLocalStorage7=useLocalStorage('enable-metric-autocomplete',true),_useLocalStorage8=_slicedToArray(_useLocalStorage7,2),enableAutocomplete=_useLocalStorage8[0],setEnableAutocomplete=_useLocalStorage8[1];var pathPrefix=usePathPrefix();var _useFetch=useFetch(\"\".concat(pathPrefix,\"/\").concat(API_PATH,\"/label/__name__/values\")),metricsRes=_useFetch.response,metricsErr=_useFetch.error;var browserTime=new Date().getTime()/1000;var _useFetch2=useFetch(\"\".concat(pathPrefix,\"/\").concat(API_PATH,\"/query?query=time()\")),timeRes=_useFetch2.response,timeErr=_useFetch2.error;useEffect(function(){if(timeRes.data){var serverTime=timeRes.data.result[0];setDelta(Math.abs(browserTime-serverTime));}/**\n     * React wants to include browserTime to useEffect dependencies list which will cause a delta change on every re-render\n     * Basically it's not recommended to disable this rule, but this is the only way to take control over the useEffect\n     * dependencies and to not include the browserTime variable.\n     **/ // eslint-disable-next-line react-hooks/exhaustive-deps\n},[timeRes.data]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Checkbox,{wrapperStyles:{marginLeft:3,display:'inline-block'},id:\"query-history-checkbox\",onChange:function onChange(_ref3){var target=_ref3.target;return setEnableQueryHistory(target.checked);},defaultChecked:enableQueryHistory},\"Enable query history\"),/*#__PURE__*/React.createElement(Checkbox,{wrapperStyles:{marginLeft:20,display:'inline-block'},id:\"use-local-time-checkbox\",onChange:function onChange(_ref4){var target=_ref4.target;return setUseLocalTime(target.checked);},defaultChecked:useLocalTime},\"Use local time\"),/*#__PURE__*/React.createElement(Checkbox,{wrapperStyles:{marginLeft:20,display:'inline-block'},id:\"autocomplete\",onChange:function onChange(_ref5){var target=_ref5.target;return setEnableAutocomplete(target.checked);},defaultChecked:enableAutocomplete},\"Enable autocomplete\"),(delta>30||timeErr)&&/*#__PURE__*/React.createElement(Alert,{color:\"danger\"},/*#__PURE__*/React.createElement(\"strong\",null,\"Warning: \"),timeErr&&\"Unexpected response status when fetching server time: \".concat(timeErr.message),delta>=30&&\"Error fetching server time: Detected \".concat(delta,\" seconds time difference between your browser and the server. Prometheus relies on accurate time and time drift might cause unexpected query results.\")),metricsErr&&/*#__PURE__*/React.createElement(Alert,{color:\"danger\"},/*#__PURE__*/React.createElement(\"strong\",null,\"Warning: \"),\"Error fetching metrics list: Unexpected response status when fetching metric names: \",metricsErr.message),/*#__PURE__*/React.createElement(PanelListContent,{panels:decodePanelOptionsFromQueryString(window.location.search),useLocalTime:useLocalTime,metrics:metricsRes.data,queryHistoryEnabled:enableQueryHistory,enableAutocomplete:enableAutocomplete}));};export default PanelList;","map":{"version":3,"sources":["/app/ui/react-app/src/pages/graph/PanelList.tsx"],"names":["React","useState","useEffect","Alert","Button","Panel","PanelDefaultOptions","Checkbox","generateID","decodePanelOptionsFromQueryString","encodePanelOptionsToQueryString","callAll","useFetch","useLocalStorage","usePathPrefix","API_PATH","updateURL","nextPanels","query","window","history","pushState","PanelListContent","metrics","useLocalTime","queryHistoryEnabled","enableAutocomplete","rest","panels","setPanels","historyItems","setLocalStorageHistoryItems","length","addPanel","onpopstate","location","search","handleExecuteQuery","isSimpleMetric","indexOf","extendedItems","reduce","acc","metric","slice","id","key","options","pathPrefix","map","opts","p","panel","PanelList","delta","setDelta","setUseLocalTime","enableQueryHistory","setEnableQueryHistory","setEnableAutocomplete","metricsRes","response","metricsErr","error","browserTime","Date","getTime","timeRes","timeErr","data","serverTime","result","Math","abs","marginLeft","display","target","checked","message"],"mappings":"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","sourcesContent":["import React, { FC, useState, useEffect } from 'react';\nimport { RouteComponentProps } from '@reach/router';\nimport { Alert, Button } from 'reactstrap';\n\nimport Panel, { PanelOptions, PanelDefaultOptions } from './Panel';\nimport Checkbox from '../../components/Checkbox';\nimport { generateID, decodePanelOptionsFromQueryString, encodePanelOptionsToQueryString, callAll } from '../../utils';\nimport { useFetch } from '../../hooks/useFetch';\nimport { useLocalStorage } from '../../hooks/useLocalStorage';\nimport { usePathPrefix } from '../../contexts/PathPrefixContext';\nimport { API_PATH } from '../../constants/constants';\n\nexport type PanelMeta = { key: string; options: PanelOptions; id: string };\n\nexport const updateURL = (nextPanels: PanelMeta[]) => {\n  const query = encodePanelOptionsToQueryString(nextPanels);\n  window.history.pushState({}, '', query);\n};\n\ninterface PanelListProps extends RouteComponentProps {\n  panels: PanelMeta[];\n  metrics: string[];\n  useLocalTime: boolean;\n  queryHistoryEnabled: boolean;\n  enableAutocomplete: boolean;\n}\n\nexport const PanelListContent: FC<PanelListProps> = ({\n  metrics = [],\n  useLocalTime,\n  queryHistoryEnabled,\n  enableAutocomplete,\n  ...rest\n}) => {\n  const [panels, setPanels] = useState(rest.panels);\n  const [historyItems, setLocalStorageHistoryItems] = useLocalStorage<string[]>('history', []);\n\n  useEffect(() => {\n    !panels.length && addPanel();\n    window.onpopstate = () => {\n      const panels = decodePanelOptionsFromQueryString(window.location.search);\n      if (panels.length > 0) {\n        setPanels(panels);\n      }\n    };\n    // We want useEffect to act only as componentDidMount, but react still complains about the empty dependencies list.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const handleExecuteQuery = (query: string) => {\n    const isSimpleMetric = metrics.indexOf(query) !== -1;\n    if (isSimpleMetric || !query.length) {\n      return;\n    }\n    const extendedItems = historyItems.reduce(\n      (acc, metric) => {\n        return metric === query ? acc : [...acc, metric]; // Prevent adding query twice.\n      },\n      [query]\n    );\n    setLocalStorageHistoryItems(extendedItems.slice(0, 50));\n  };\n\n  const addPanel = () => {\n    callAll(\n      setPanels,\n      updateURL\n    )([\n      ...panels,\n      {\n        id: generateID(),\n        key: `${panels.length}`,\n        options: PanelDefaultOptions,\n      },\n    ]);\n  };\n\n  const pathPrefix = usePathPrefix();\n\n  return (\n    <>\n      {panels.map(({ id, options }) => (\n        <Panel\n          pathPrefix={pathPrefix}\n          onExecuteQuery={handleExecuteQuery}\n          key={id}\n          options={options}\n          onOptionsChanged={opts =>\n            callAll(setPanels, updateURL)(panels.map(p => (id === p.id ? { ...p, options: opts } : p)))\n          }\n          removePanel={() =>\n            callAll(\n              setPanels,\n              updateURL\n            )(\n              panels.reduce<PanelMeta[]>(\n                (acc, panel) => (panel.id !== id ? [...acc, { ...panel, key: `${acc.length}` }] : acc),\n                []\n              )\n            )\n          }\n          useLocalTime={useLocalTime}\n          metricNames={metrics}\n          pastQueries={queryHistoryEnabled ? historyItems : []}\n          enableAutocomplete={enableAutocomplete}\n        />\n      ))}\n      <Button className=\"d-block mb-3\" color=\"primary\" onClick={addPanel}>\n        Add Panel\n      </Button>\n    </>\n  );\n};\n\nconst PanelList: FC<RouteComponentProps> = () => {\n  const [delta, setDelta] = useState(0);\n  const [useLocalTime, setUseLocalTime] = useLocalStorage('use-local-time', false);\n  const [enableQueryHistory, setEnableQueryHistory] = useLocalStorage('enable-query-history', false);\n  const [enableAutocomplete, setEnableAutocomplete] = useLocalStorage('enable-metric-autocomplete', true);\n\n  const pathPrefix = usePathPrefix();\n  const { response: metricsRes, error: metricsErr } = useFetch<string[]>(`${pathPrefix}/${API_PATH}/label/__name__/values`);\n\n  const browserTime = new Date().getTime() / 1000;\n  const { response: timeRes, error: timeErr } = useFetch<{ result: number[] }>(\n    `${pathPrefix}/${API_PATH}/query?query=time()`\n  );\n\n  useEffect(() => {\n    if (timeRes.data) {\n      const serverTime = timeRes.data.result[0];\n      setDelta(Math.abs(browserTime - serverTime));\n    }\n    /**\n     * React wants to include browserTime to useEffect dependencies list which will cause a delta change on every re-render\n     * Basically it's not recommended to disable this rule, but this is the only way to take control over the useEffect\n     * dependencies and to not include the browserTime variable.\n     **/\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [timeRes.data]);\n\n  return (\n    <>\n      <Checkbox\n        wrapperStyles={{ marginLeft: 3, display: 'inline-block' }}\n        id=\"query-history-checkbox\"\n        onChange={({ target }) => setEnableQueryHistory(target.checked)}\n        defaultChecked={enableQueryHistory}\n      >\n        Enable query history\n      </Checkbox>\n      <Checkbox\n        wrapperStyles={{ marginLeft: 20, display: 'inline-block' }}\n        id=\"use-local-time-checkbox\"\n        onChange={({ target }) => setUseLocalTime(target.checked)}\n        defaultChecked={useLocalTime}\n      >\n        Use local time\n      </Checkbox>\n      <Checkbox\n        wrapperStyles={{ marginLeft: 20, display: 'inline-block' }}\n        id=\"autocomplete\"\n        onChange={({ target }) => setEnableAutocomplete(target.checked)}\n        defaultChecked={enableAutocomplete}\n      >\n        Enable autocomplete\n      </Checkbox>\n      {(delta > 30 || timeErr) && (\n        <Alert color=\"danger\">\n          <strong>Warning: </strong>\n          {timeErr && `Unexpected response status when fetching server time: ${timeErr.message}`}\n          {delta >= 30 &&\n            `Error fetching server time: Detected ${delta} seconds time difference between your browser and the server. Prometheus relies on accurate time and time drift might cause unexpected query results.`}\n        </Alert>\n      )}\n      {metricsErr && (\n        <Alert color=\"danger\">\n          <strong>Warning: </strong>\n          Error fetching metrics list: Unexpected response status when fetching metric names: {metricsErr.message}\n        </Alert>\n      )}\n      <PanelListContent\n        panels={decodePanelOptionsFromQueryString(window.location.search)}\n        useLocalTime={useLocalTime}\n        metrics={metricsRes.data}\n        queryHistoryEnabled={enableQueryHistory}\n        enableAutocomplete={enableAutocomplete}\n      />\n    </>\n  );\n};\n\nexport default PanelList;\n"]},"metadata":{},"sourceType":"module"}